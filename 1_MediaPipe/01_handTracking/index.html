<!DOCTYPE html>  
<html> 

<head> 
    <meta charset="UTF-8" /> 
    <title>MediaPipe Hand Tracking - Pinch Detection</title> 

    <!-- MediaPipe ë¼ì´ë¸ŒëŸ¬ë¦¬ CDN ë¡œë“œ ì‹œì‘ -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script> <!-- MediaPipe Hands í•µì‹¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script> <!-- ì¹´ë©”ë¼ ì œì–´ ìœ í‹¸ë¦¬í‹° -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script> <!-- ëœë“œë§ˆí¬ ê·¸ë¦¬ê¸° ìœ í‹¸ë¦¬í‹° -->

    <style>  
        body {
            margin: 0;  
            background: #111;  
            display: flex;  
            flex-direction: column;  
            align-items: center;  
            color: white;  
            font-family: sans-serif;  
        }

        canvas {
            border: 2px solid #444;  
            margin-top: 10px;  
        }

        #status {
            margin-top: 15px;  
            font-size: 24px;  
            font-weight: bold;  
        }
    </style>  
</head>  

<body>  

    <h2>MediaPipe Hand Tracking (Pinch Detection)</h2>  

    <video class="input_video" style="display:none;"></video> <!-- ì›¹ìº  ë¹„ë””ì˜¤ ìš”ì†Œ (í™”ë©´ì— í‘œì‹œ ì•ˆ í•¨) -->
    <canvas class="output_canvas" width="640" height="480"></canvas> <!-- ê²°ê³¼ ì¶œë ¥ìš© ìº”ë²„ìŠ¤ (640x480 í¬ê¸°) -->

    <div id="status">âœ‹ ì†ì„ ë³´ì—¬ì£¼ì„¸ìš”</div> <!-- ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­ -->

    <script> 
        const videoElement = document.querySelector('.input_video'); // ë¹„ë””ì˜¤ ìš”ì†Œ ì„ íƒí•˜ì—¬ ë³€ìˆ˜ì— ì €ì¥
        const canvasElement = document.querySelector('.output_canvas'); // ìº”ë²„ìŠ¤ ìš”ì†Œ ì„ íƒí•˜ì—¬ ë³€ìˆ˜ì— ì €ì¥
        const canvasCtx = canvasElement.getContext('2d'); // 2D ê·¸ë¦¬ê¸°ë¥¼ ìœ„í•œ ìº”ë²„ìŠ¤ ì»¨í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
        const statusText = document.getElementById('status'); // ìƒíƒœ í…ìŠ¤íŠ¸ ìš”ì†Œ ì„ íƒí•˜ì—¬ ë³€ìˆ˜ì— ì €ì¥

        // MediaPipe Hands ì´ˆê¸°í™” - Hands ê°ì²´ ìƒì„±
        const hands = new Hands({ // ìƒˆë¡œìš´ Hands ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
            locateFile: (file) => { // ëª¨ë¸ íŒŒì¼ ìœ„ì¹˜ ì§€ì • í•¨ìˆ˜
                return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`; // CDNì—ì„œ íŒŒì¼ ê²½ë¡œ ë°˜í™˜
            }
        });

        hands.setOptions({ // Hands ëª¨ë¸ ì˜µì…˜ ì„¤ì •
            maxNumHands: 1, // ìµœëŒ€ ê°ì§€í•  ì†ì˜ ê°œìˆ˜ë¥¼ 1ê°œë¡œ ì œí•œ
            modelComplexity: 1, // ëª¨ë¸ ë³µì¡ë„ ì„¤ì • (0: ê°€ë²¼ì›€, 1: ë³´í†µ, 2: ì •í™•)
            minDetectionConfidence: 0.7, // ì† ê°ì§€ ìµœì†Œ ì‹ ë¢°ë„ (0.0~1.0)
            minTrackingConfidence: 0.7 // ì† ì¶”ì  ìµœì†Œ ì‹ ë¢°ë„ (0.0~1.0)
        });

        hands.onResults(results => { // ì† ê°ì§€ ê²°ê³¼ë¥¼ ë°›ì•„ ì²˜ë¦¬í•˜ëŠ” ì½œë°± í•¨ìˆ˜
            canvasCtx.save(); // í˜„ì¬ ìº”ë²„ìŠ¤ ìƒíƒœ ì €ì¥
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height); // ìº”ë²„ìŠ¤ ì „ì²´ë¥¼ ì§€ì›Œì„œ ì´ˆê¸°í™”
            canvasCtx.drawImage( // ë¹„ë””ì˜¤ ì´ë¯¸ì§€ë¥¼ ìº”ë²„ìŠ¤ì— ê·¸ë¦¬ê¸°
                results.image, // ì›¹ìº ì—ì„œ ìº¡ì²˜í•œ ì´ë¯¸ì§€
                0, // ê·¸ë¦¬ê¸° ì‹œì‘ X ì¢Œí‘œ
                0, // ê·¸ë¦¬ê¸° ì‹œì‘ Y ì¢Œí‘œ
                canvasElement.width, // ê·¸ë¦´ ì´ë¯¸ì§€ì˜ ë„ˆë¹„
                canvasElement.height // ê·¸ë¦´ ì´ë¯¸ì§€ì˜ ë†’ì´
            );

            if (results.multiHandLandmarks) { // ì† ëœë“œë§ˆí¬ê°€ ê°ì§€ë˜ì—ˆëŠ”ì§€ í™•ì¸
                const landmarks = results.multiHandLandmarks[0]; // ì²« ë²ˆì§¸ ì†ì˜ ëœë“œë§ˆí¬ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

                // ì† ëœë“œë§ˆí¬ ê·¸ë¦¬ê¸°
                drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS); // ì†ê°€ë½ ë¼ˆëŒ€(ì—°ê²°ì„ ) ê·¸ë¦¬ê¸°
                drawLandmarks(canvasCtx, landmarks); // ì† ê´€ì ˆ(ëœë“œë§ˆí¬ ì ) ê·¸ë¦¬ê¸°

                // ì—„ì§€ ë(4ë²ˆ) & ê²€ì§€ ë(8ë²ˆ)
                const thumbTip = landmarks[4]; // ì—„ì§€ ì†ê°€ë½ ë ì¢Œí‘œ ê°€ì ¸ì˜¤ê¸° (ëœë“œë§ˆí¬ ì¸ë±ìŠ¤ 4ë²ˆ)
                const indexTip = landmarks[8]; // ê²€ì§€ ì†ê°€ë½ ë ì¢Œí‘œ ê°€ì ¸ì˜¤ê¸° (ëœë“œë§ˆí¬ ì¸ë±ìŠ¤ 8ë²ˆ)

                // ê±°ë¦¬ ê³„ì‚° - ìœ í´ë¦¬ë“œ ê±°ë¦¬ ê³µì‹ ì‚¬ìš©
                const distance = Math.sqrt( // ì œê³±ê·¼ ê³„ì‚°
                    Math.pow(thumbTip.x - indexTip.x, 2) + // Xì¶• ê±°ë¦¬ì˜ ì œê³±
                    Math.pow(thumbTip.y - indexTip.y, 2) // Yì¶• ê±°ë¦¬ì˜ ì œê³±
                ); // ë‘ ì†ê°€ë½ ë ì‚¬ì´ì˜ ì§ì„  ê±°ë¦¬

                // ì„ê³„ê°’ ë¹„êµí•˜ì—¬ í•€ì¹˜ ë™ì‘ íŒë³„
                if (distance < 0.05) { // ê±°ë¦¬ê°€ 0.05ë³´ë‹¤ ì‘ìœ¼ë©´ (ì†ê°€ë½ì´ ê°€ê¹Œìš°ë©´)
                    statusText.innerText = "ğŸ¤ ì§‘ê¸° ë™ì‘ ê°ì§€!"; // ìƒíƒœ í…ìŠ¤íŠ¸ë¥¼ ì§‘ê¸° ê°ì§€ë¡œ ë³€ê²½
                    statusText.style.color = "lime"; // í…ìŠ¤íŠ¸ ìƒ‰ìƒì„ ì—°ë‘ìƒ‰ìœ¼ë¡œ ë³€ê²½
                } else { // ê±°ë¦¬ê°€ 0.05 ì´ìƒì´ë©´ (ì†ê°€ë½ì´ ë©€ë©´)
                    statusText.innerText = "âœ‹ ì†ì„ ë³´ì—¬ì£¼ì„¸ìš”"; // ìƒíƒœ í…ìŠ¤íŠ¸ë¥¼ ê¸°ë³¸ ë©”ì‹œì§€ë¡œ ë³€ê²½
                    statusText.style.color = "white"; // í…ìŠ¤íŠ¸ ìƒ‰ìƒì„ í°ìƒ‰ìœ¼ë¡œ ë³€ê²½
                }

            } else { // ì†ì´ ê°ì§€ë˜ì§€ ì•Šì•˜ì„ ë•Œ
                statusText.innerText = "âœ‹ ì†ì„ ë³´ì—¬ì£¼ì„¸ìš”"; // ìƒíƒœ í…ìŠ¤íŠ¸ë¥¼ ê¸°ë³¸ ë©”ì‹œì§€ë¡œ ì„¤ì •
                statusText.style.color = "white"; // í…ìŠ¤íŠ¸ ìƒ‰ìƒì„ í°ìƒ‰ìœ¼ë¡œ ì„¤ì •
            }

            canvasCtx.restore(); // ì €ì¥í–ˆë˜ ìº”ë²„ìŠ¤ ìƒíƒœ ë³µì›
        });

        // ì¹´ë©”ë¼ ì—°ê²° ë° ì„¤ì •
        const camera = new Camera(videoElement, { // ìƒˆë¡œìš´ Camera ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
            onFrame: async () => { // ë§¤ í”„ë ˆì„ë§ˆë‹¤ ì‹¤í–‰ë  ë¹„ë™ê¸° í•¨ìˆ˜
                await hands.send({ image: videoElement }); // í˜„ì¬ ë¹„ë””ì˜¤ í”„ë ˆì„ì„ Hands ëª¨ë¸ë¡œ ì „ì†¡í•˜ì—¬ ì²˜ë¦¬
            },
            width: 640, // ì¹´ë©”ë¼ í•´ìƒë„ ë„ˆë¹„ 640í”½ì…€
            height: 480 // ì¹´ë©”ë¼ í•´ìƒë„ ë†’ì´ 480í”½ì…€
        });

        camera.start(); // ì¹´ë©”ë¼ ì‹œì‘ (ì›¹ìº  í™œì„±í™” ë° í”„ë ˆì„ ìº¡ì²˜ ì‹œì‘)
    </script>  

</body> 

</html>  